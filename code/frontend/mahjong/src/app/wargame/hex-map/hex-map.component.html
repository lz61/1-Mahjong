<!-- ä¾§è¾¹æ  -->

<div [ngClass]="{ 'sidebar-open': isSidebarOpen, 'sidebar-closed': !isSidebarOpen }" class="sidebar">
    <br>
    <button (click)="saveUnitsToFile()">ä¿å­˜å…µç§åˆ°æ–‡ä»¶</button>
    <!-- åŠ è½½å…µç§çš„æŒ‰é’® -->
    <div style="margin-top: 10px;">
        <button (click)="fileInput.click()">åŠ è½½å…µç§</button>
        <input #fileInput type="file" (change)="loadUnitsFromFile($event)" accept=".json" style="display: none;" />
    </div>

    <div class="sidebar-content">
        <!-- æ˜¾ç¤ºç©å®¶å•ä½åˆ—è¡¨ -->

        <!-- æ˜¾ç¤ºç©å®¶é‡‘å¸ -->
        <div class="player-info">
            <h3>ç©å®¶ä¿¡æ¯</h3>
            <p>å¯ç”¨é‡‘å¸: {{ playerMoney }}</p>
            <p>å›åˆ: {{ currentTurn === 'player' ? 'ç©å®¶å›åˆ' : 'AI å›åˆ' }}</p>
            <p>å›åˆæ•°: {{turnCount}}</p>
        </div>
    </div>
</div>

<!-- å°†é¢†,é¡¶å±‚æ  -->
<div
    style="position: fixed; top: 0; left: 0; right: 0; background-color: #f4f4f4; border-bottom: 2px solid #ccc; padding: 4px;">
    <div style="display: flex; align-items: center; justify-content: center; gap: 10%;">
        <div *ngFor="let general of generals" style="text-align: center;">
            <img [src]="general.image" alt="{{ general.name }}"
                style="width: 50px; height: 45px; border-radius: 50%; cursor: pointer;"
                (mouseenter)="showGeneralSkill(general,$event)"
                (mouseleave)="hideGeneralSkill()"
                 />
            <div style="font-size: 12px; font-weight: bold;">
                {{ general.name }}
            </div>
            <div style="font-size: 20px; font-weight: bold; ">
                {{ general.skillDescription }}
            </div>
        </div>
    </div>
    <!-- <div *ngIf="hoveredGeneral" [ngStyle]="tooltipStyle"
        style="position: absolute; background: #fff; border: 1px solid #ccc; padding: 100px; z-index: 9999;">
        <p style="margin: 0; font-size: 20px; z-index: 9999;">{{ hoveredGeneral.skillDescription }}</p>
    </div> -->
</div>

<!-- é™åˆ¶å…­è¾¹å½¢åœ°å›¾çš„å¤§å° -->
<svg [attr.width]="mapWidth" [attr.height]="mapHeight" 
    style="border: 1px solid black"
    style="position: absolute; left: 20%; top: 10%;">
    <g *ngFor="let hex of hexagons">
        <polygon [attr.points]="getHexagonPoints(hex)" stroke="black" 
        stroke-width="1" fill="gray"
            (click)="onHexClick(hex)" [ngStyle]="{ fill: hex.color }">
        </polygon>
        <image *ngIf="hex.unit" [attr.x]="hex.x - hex.size / 2" 
        [attr.y]="hex.y - hex.size / 2"
            [attr.width]="hex.size " [attr.height]="hex.size " [attr.href]="hex.unit.image"
            (click)="onHexClick(hex)">
        </image>

        <!-- æ˜¾ç¤ºè¡€é‡æ¡ -->
        <rect *ngIf="this.hex.unit" [attr.x]="hex.x - hex.size / 2" [attr.y]="hex.y - hex.size / 2 - 8"
            [attr.width]="(this.hex.unit.health / this.hex.unit.maxHealth) * hex.size" height="5"
            [attr.fill]="getHealthBarColor(this.hex.unit.health, this.hex.unit.maxHealth)">
        </rect>
        <!-- æ˜¾ç¤ºé˜µè¥é¢œè‰² -->
        <circle *ngIf="this.hex.unit&&this.hex.unit?.camp " [attr.cx]="hex.x"
            [attr.cy]="hex.y + hex.size / 2 + 10" r="5"
            [attr.fill]="this.hex.unit.camp === playerCamp ? playerCampColor : aiCampColor">
        </circle>
        <!-- æ˜¾ç¤ºå…µç§è¡€é‡ -->
        <text *ngIf="this.hex.unit" [attr.x]="hex.x" [attr.y]="hex.y + hex.size / 2" font-size="12"
            text-anchor="middle" fill="red">
            {{ this.hex.unit.health }}
        </text>
    </g>
</svg>

<audio id="background-music" autoplay loop>
    <source src="assets/music/background-music.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
</audio>
<div class="controls" style="position: fixed; bottom: 20px; right: 200px;">
    <button (click)="toggleMusic()">ğŸµ {{ isMusicPlaying ? 'æš‚åœéŸ³ä¹' : 'æ’­æ”¾éŸ³ä¹' }}</button>
</div>

<div class="controls" style="position: fixed; bottom: 20px; right: 20px;">
    <button (click)="endPlayerTurn()">ç»“æŸå›åˆ</button>
</div>

